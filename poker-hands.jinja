<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.min.css" integrity="sha256-6ZFIKt0ohcBorQWIruhlYBoADBIFrJuXtEJsjFxb2Wk=" crossorigin="anonymous" /> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <title>Poker Night in America</title>

<style>

body{
    background-color: #d7d8cd;
}

.container, .cards, .community-cards{
    display: flex;
    flex-direction: row;
    justify-content: space-around;
    align-items: flex-end;
}

.top-summary{
    margin-bottom: 1em;
}

.players{
    flex-flow: row wrap;
    align-items: stretch;
    margin-bottom: 1em;
}

.flop, .turn, .river{
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    margin: 10px 10px 10px 10px;
}

.flop .cards .label, .turn .label, .river .label{
    text-align: center;
}

.playing-card{
    border: 1px solid black;
    width: 20px;
    margin: 2px;
}

.info{
    border: 1px solid black;
    box-shadow: 2px 4px #777;
    background-color: white;
}

.player{
    padding: 0.3em 1em 0.3em 1em;
    flex-basis: 15%;
    margin: 5px;
}

.hand-winner{
    background-color: #7baa2e;
}

.empty-seat{
    border: 1px dashed grey;
}

.player-name-line{
    /*display: flex;
    flex-direction: row;
    justify-content: space-between;*/
    font-weight: bold;
    text-decoration: underline;
}

.player-name-line .player{
    padding-right: 1em;
}

.player-badges{
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
}

.def-line{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}

.def-line .label{
    margin-right: 8px;
}

.label{
    font-weight: bold;
}

.encircled{
    border-radius: 50%;
    border: 2px solid #666;
    text-align: center;
    padding: 0.4em;
}

.diams {
    color: #00f;
}
.hearts {
    color: #f00;
}
.spades {
    color: #000;
}
.clubs {
    color: #090;
}

table{
    background: white;
    border: 1px solid black;
}
tbody tr:nth-child(odd) {
  background: #eee;
}

</style>

</head>
<body>

{% macro display_definitions(definitions) %}
    <ul>
        {% for def, value in definitions %}
            <li><strong>{{def}}: </strong>{{value}}</li>
        {% endfor %}
    </ul>
{% endmacro %}

{% for hand in poker_hands %}

<div class="container top-summary">
    <div class="info hand-summary">
        <div class="def-line hand"><div class="label hand">Hand Number</div><div class="value hand">{{hand.number}}</div></div>
        <div class="def-line date"><div class="label date">Date</div><div class="value date">Value</div></div>
        <div class="def-line name"><div class="label name">Name of Sheet Imported</div><div class="value name">Value</div></div>
        <div class="def-line start"><div class="label start">Start Time</div><div class="value start">{{hand.starting_time}}</div></div>
        <div class="def-line end"><div class="label end">End Time</div><div class="value end">{{hand.ending_time}}</div></div>
        <div class="def-line duration"><div class="label duration">Duration</div><div class="value duration">{{hand.duration}}</div></div>
    </div>


    <div class="info community-cards">
        {% if hand.has_flop %}
            <div class="flop">
                <div class="cards">
                    <div class="commcard">{{ hand.flop[0] | display_card }}</div>
                    <div class="commcard">{{ hand.flop[1] | display_card }}</div>
                    <div class="commcard">{{ hand.flop[2] | display_card }}</div>
                </div>
                <div class="label">Flop</div>
            </div>
            {% if hand.has_turn %}
                <div class="turn">
                    <div class="commcard">{{ hand.flop[3] | display_card }}</div>
                    <div class="label">Turn</div>
                </div>
                {% if hand.has_river %}
                    <div class="river">
                        <div class="commcard">{{ hand.flop[4] | display_card }}</div>
                        <div class="label">River</div>
                    </div>
                {% endif %}
            {% endif %}
        {% endif %}
    </div>

    <div class="info blinds">
        <div class="def-line big-blind"><div class="label">Big Blind Amount</div><div class="value">{{hand.big_blind}}</div></div>
        <div class="def-line small-blind"><div class="label">Small Blind Amount</div><div class="value">{{hand.small_blind}}</div></div>
        <div class="def-line ante"><div class="label">Ante Amount</div><div class="value">{{hand.ante}}</div></div>
    </div>

</div>

{% macro display_player(player) %}

    <div class="info player player-{{player.index}} {% if player.hand_winner %}hand-winner{% endif %}">
        <div class="player-name-line">
            <span class="player">P{{player.index}}</span>
            <span class="name">{{player.name}}</span>
        </div>
        <div class="def-line chips-start"><div class="label">S:</div><div class="value">{{player.starting_stack}}</div></div>
        <div class="def-line chips-start"><div class="label">E:</div><div class="value">{{player.ending_stack}}</div></div>
        <div class="cards">
            <div class="card">{{player.pocket[0]|display_card}}</div>
            <div class="card">{{player.pocket[1]|display_card}}</div>
        </div>
        <div class="def-line chips-start"><div class="label">Str:</div><div class="value">{{player.straddle}}</div></div>
        <div class="player-badges">
            {% if hand.dealer == player.index %}
                <div class="encircled player-dealer">D</div>
            {% endif %}
            {% if hand.small_blind_player == player.index %}
                <div class="encircled player-smallblind">SB</div>
            {% endif %}
            {% if hand.big_blind_player == player.index %}
                <div class="encircled player-bigblind">BB</div>
            {% endif %}
            {% if player.hand_winner %}
                <div class="encircled player-winner">W</div>
            {% endif %}
        </div>
    </div>
{% endmacro %}

<div class="container players">
    {% for player in hand.players %}
        {{display_player(player)}}
    {% endfor %}
    {% for box in hand.empty_seats %}
        <div class="info empty-seat player">
            Empty seat {{box}}
        </div>
    {% endfor %}
</div>
{% if False %}
<div class="container players">
    {% for player in hand.players[5:] %}
        {{display_player(player)}}
    {% endfor %}
</div>
{% endif %}

<div class="container events-list">
<table>
    <thead>
        <tr><th>Time</th><th>Action</th><th>Pot</th>
            {% for p in hand.taking_part %}
                <th>{{p.index}}</th>
            {% endfor %}
            </tr>
    </thead>
    <tbody>
        {% for event in hand.events if event.display %}
            {% if event.display %}
                <tr>
                    <td>{{event.starting_time}}</td>
                    <td>
                        {% if event.bold %}
                            <strong>{{event.description}}</strong>
                        {% else %}
                            {{event.description}}
                        {% endif %}
                    </td>
                    <td>{{event.pot}}</td>
                    {% if event.win_probabilities %}
                        {% for p in hand.taking_part %}
                            <td>{{event.win_probabilities.get(p.index, "-")}}</td>
                        {% endfor %}
                    {% endif %}
                </tr>
            {% endif %}
        {% endfor %}
    </tbody>
</table>
</div>

{% endfor %}

</body>
</html>
